# PageRank é›†æˆä½¿ç”¨è¯´æ˜

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [PageRank åŸºæœ¬é€»è¾‘](#pagerank-åŸºæœ¬é€»è¾‘)
3. [å¦‚ä½•ä½¿ç”¨](#å¦‚ä½•ä½¿ç”¨)
4. [é¡¹ç›®ç»“æ„å˜æ›´](#é¡¹ç›®ç»“æ„å˜æ›´)
5. [ä¿®æ”¹çš„æ–‡ä»¶åŠä½œç”¨](#ä¿®æ”¹çš„æ–‡ä»¶åŠä½œç”¨)
6. [æ–°å¢çš„Pythonæ–‡ä»¶è¯´æ˜](#æ–°å¢çš„pythonæ–‡ä»¶è¯´æ˜)
7. [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
8. [è¾“å‡ºæ–‡ä»¶](#è¾“å‡ºæ–‡ä»¶)

---

## æ¦‚è¿°

PageRank ç®—æ³•å·²é›†æˆåˆ°è”é‚¦å­¦ä¹ è®­ç»ƒæµç¨‹ä¸­ï¼Œç”¨äºè¯„ä¼°å®¢æˆ·ç«¯åœ¨è”é‚¦å­¦ä¹ ç½‘ç»œä¸­çš„é‡è¦æ€§ï¼Œå¹¶è‡ªåŠ¨å‰”é™¤ä½è´¨é‡çš„å®¢æˆ·ç«¯ï¼Œä»è€Œæå‡å…¨å±€æ¨¡å‹çš„è®­ç»ƒè´¨é‡ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… ä»è®­ç»ƒæ—¥å¿—ä¸­æå–å®¢æˆ·ç«¯é€šä¿¡å…³ç³»
- âœ… è®¡ç®—æ¯ä¸ªå®¢æˆ·ç«¯çš„ PageRank é‡è¦æ€§åˆ†æ•°
- âœ… è‡ªåŠ¨å‰”é™¤ä½åˆ†å®¢æˆ·ç«¯ï¼ˆåˆ†æ•° < 0.3ï¼‰
- âœ… åªèšåˆé«˜è´¨é‡å®¢æˆ·ç«¯çš„æ¨¡å‹å‚æ•°

---

## PageRank åŸºæœ¬é€»è¾‘

### 1. ç®—æ³•åŸç†

PageRank æ˜¯ Google ç”¨æ¥è¯„ä¼°ç½‘é¡µé‡è¦æ€§çš„ç®—æ³•ã€‚åœ¨è”é‚¦å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥è¯„ä¼°**å®¢æˆ·ç«¯çš„é‡è¦æ€§**ã€‚

**æ ¸å¿ƒæ€æƒ³ï¼š**
- å¦‚æœå®¢æˆ·ç«¯ A çš„æ¨¡å‹æ›´æ–°è¢«å¾ˆå¤šå…¶ä»–å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œé‚£ä¹ˆ A çš„é‡è¦æ€§é«˜
- å¦‚æœå®¢æˆ·ç«¯ B å¾ˆå°‘ä¸å…¶ä»–å®¢æˆ·ç«¯é€šä¿¡ï¼Œé‚£ä¹ˆ B çš„é‡è¦æ€§ä½
- PageRank åˆ†æ•°ä½çš„å®¢æˆ·ç«¯å¯èƒ½æ˜¯å¼‚å¸¸å®¢æˆ·ç«¯ï¼Œåº”è¯¥è¢«å‰”é™¤

### 2. è®¡ç®—æµç¨‹

```
1. æ„å»ºé€šä¿¡å›¾
   â””â”€> ä»æ—¥å¿—ä¸­æå–å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡å…³ç³»
   â””â”€> å½¢æˆæœ‰å‘å›¾ï¼šå®¢æˆ·ç«¯A â†’ å®¢æˆ·ç«¯Bï¼ˆè¡¨ç¤ºAçš„æ›´æ–°è¢«Bä½¿ç”¨ï¼‰

2. è®¡ç®— PageRank åˆ†æ•°
   â””â”€> ä½¿ç”¨ networkx.pagerank ç®—æ³•
   â””â”€> æ¯ä¸ªå®¢æˆ·ç«¯å¾—åˆ°ä¸€ä¸ªåˆ†æ•°ï¼ˆåŸå§‹åˆ†æ•°ï¼šæ‰€æœ‰åˆ†æ•°ä¹‹å’Œä¸º1ï¼‰

3. åˆ†æ•°å½’ä¸€åŒ–
   â””â”€> å°†åŸå§‹åˆ†æ•°æ˜ å°„åˆ° [0, 1] åŒºé—´
   â””â”€> å…¬å¼ï¼špr_norm = (pr - min) / (max - min)
   â””â”€> ç›®çš„ï¼šä½¿é˜ˆå€¼åˆ¤æ–­åœ¨ä¸åŒå®¢æˆ·ç«¯æ•°é‡ä¸‹ä¿æŒä¸€è‡´

4. å‰”é™¤ä½åˆ†å®¢æˆ·ç«¯
   â””â”€> å½’ä¸€åŒ–åˆ†æ•° < 0.3 çš„å®¢æˆ·ç«¯è¢«å‰”é™¤
   â””â”€> åªä¿ç•™é«˜åˆ†å®¢æˆ·ç«¯å‚ä¸åç»­è®­ç»ƒ
```

### 3. ä¸ºä»€ä¹ˆéœ€è¦å½’ä¸€åŒ–ï¼Ÿ

**é—®é¢˜ï¼š**
- åŸå§‹ PageRank åˆ†æ•°çš„ç»å¯¹å€¼èŒƒå›´ä¼šéšå®¢æˆ·ç«¯æ•°é‡å˜åŒ–
- ä¾‹å¦‚ï¼š8ä¸ªå®¢æˆ·ç«¯æ—¶åˆ†æ•°åœ¨ [0.07, 0.14]ï¼Œä½†100ä¸ªå®¢æˆ·ç«¯æ—¶å¯èƒ½åœ¨ [0.005, 0.02]
- ä½¿ç”¨å›ºå®šé˜ˆå€¼ï¼ˆå¦‚0.3ï¼‰åœ¨å®¢æˆ·ç«¯æ•°é‡ä¸åŒæ—¶ä¼šäº§ç”Ÿä¸ä¸€è‡´çš„ç­›é€‰æ•ˆæœ

**è§£å†³æ–¹æ¡ˆï¼š**
- å½’ä¸€åŒ–åï¼Œåˆ†æ•°èŒƒå›´å§‹ç»ˆæ˜¯ [0, 1]
- 0.3 è¡¨ç¤º"ç›¸å¯¹æ’ååœ¨å‰70%"ï¼Œè€Œä¸æ˜¯"ç»å¯¹åˆ†æ•°å¤§äº0.3"
- ä½¿å¾—é˜ˆå€¼å…·æœ‰ç»Ÿä¸€çš„è¯­ä¹‰ï¼Œé€‚åº”ä¸åŒè§„æ¨¡çš„è”é‚¦å­¦ä¹ ç½‘ç»œ

---

## å¦‚ä½•ä½¿ç”¨

### 1. è¿è¡Œè®­ç»ƒè„šæœ¬

ä½¿ç”¨é›†æˆäº† PageRank çš„è®­ç»ƒè„šæœ¬ï¼š

```bash
python src/Serverlesscase/Serverless_NonIID_Medical_transcriptions_with_pagerank.py
```

### 2. è®­ç»ƒæµç¨‹

**Round 1ï¼ˆç¬¬ä¸€è½®ï¼‰ï¼š**
- æ‰€æœ‰å®¢æˆ·ç«¯å‚ä¸è®­ç»ƒ
- è®°å½•é€šä¿¡æ—¥å¿—åˆ° `logs/blockchain_log.jsonl`
- **ä¸åº”ç”¨ PageRank**ï¼ˆéœ€è¦å…ˆæœ‰æ—¥å¿—æ‰èƒ½è®¡ç®—ï¼‰
- èšåˆæ‰€æœ‰å®¢æˆ·ç«¯çš„å‚æ•°

**Round 2 åŠä¹‹åï¼š**
- ä»æ—¥å¿—ä¸­æå–é€šä¿¡å›¾
- è®¡ç®— PageRank åˆ†æ•°
- å‰”é™¤ä½åˆ†å®¢æˆ·ç«¯ï¼ˆåˆ†æ•° < 0.3ï¼‰
- **åªèšåˆé«˜åˆ†å®¢æˆ·ç«¯çš„å‚æ•°**
- è¢«å‰”é™¤çš„å®¢æˆ·ç«¯ä¸å†å‚ä¸åç»­è®­ç»ƒ

### 3. é…ç½®å‚æ•°

åœ¨è®­ç»ƒè„šæœ¬ä¸­å¯ä»¥è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

```python
NUM_CLIENTS = 8              # å®¢æˆ·ç«¯æ€»æ•°
NUM_ROUNDS = 3               # è®­ç»ƒè½®æ•°
PAGERANK_THRESHOLD = 0.3     # PageRank å‰”é™¤é˜ˆå€¼ï¼ˆå½’ä¸€åŒ–åçš„åˆ†æ•°ï¼‰
```

**é˜ˆå€¼è¯´æ˜ï¼š**
- `PAGERANK_THRESHOLD = 0.3` è¡¨ç¤ºå‰”é™¤å½’ä¸€åŒ–åˆ†æ•° < 0.3 çš„å®¢æˆ·ç«¯
- å³ä¿ç•™ç›¸å¯¹æ’ååœ¨å‰70%çš„å®¢æˆ·ç«¯
- å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ï¼ˆä¾‹å¦‚ï¼š0.2 è¡¨ç¤ºä¿ç•™å‰80%ï¼Œ0.4 è¡¨ç¤ºä¿ç•™å‰60%ï¼‰

---

## é¡¹ç›®ç»“æ„å˜æ›´

### æ–°å¢æ–‡ä»¶

1. **`src/pagerank_utils.py`**
   - PageRank è®¡ç®—æ ¸å¿ƒæ¨¡å—
   - æä¾› `compute_pagerank_scores()` å‡½æ•°
   - æä¾› `sort_scores_desc()` è¾…åŠ©å‡½æ•°

2. **`src/graph_extractor.py`**
   - ä»åŒºå—é“¾æ—¥å¿—ä¸­æå–é€šä¿¡å›¾
   - æä¾› `extract_graph_from_rounds()` å‡½æ•°
   - è§£æ `logs/blockchain_log.jsonl` æ–‡ä»¶

3. **`src/Serverlesscase/Serverless_NonIID_Medical_transcriptions_with_pagerank.py`**
   - é›†æˆ PageRank çš„è®­ç»ƒè„šæœ¬
   - åŸºäºåŸå§‹è„šæœ¬ `Serverless_NonIID_Medical_transcriptions.py` ä¿®æ”¹

### åŸå§‹æ–‡ä»¶ï¼ˆæœªä¿®æ”¹ï¼‰

- `src/Serverlesscase/Serverless_NonIID_Medical_transcriptions.py`
  - åŸå§‹è®­ç»ƒè„šæœ¬ä¿æŒä¸å˜
  - å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œä¸åŒ…å« PageRank åŠŸèƒ½

---

## ä¿®æ”¹çš„æ–‡ä»¶åŠä½œç”¨

### 1. `src/pagerank_utils.py`ï¼ˆæ–°å¢ï¼‰

**ä½œç”¨ï¼š** æä¾› PageRank è®¡ç®—åŠŸèƒ½

**å…³é”®å‡½æ•°ï¼š**

```python
def compute_pagerank_scores(clients, edges, alpha=0.85):
    """
    è®¡ç®—æ¯ä¸ªå®¢æˆ·ç«¯çš„ PageRank å¾—åˆ†
    
    å‚æ•°ï¼š
    - clients: å®¢æˆ·ç«¯ ID åˆ—è¡¨ï¼Œä¾‹å¦‚ [0, 1, 2, 3]
    - edges: æœ‰å‘è¾¹åˆ—è¡¨ï¼Œä¾‹å¦‚ [(0, 1), (1, 2)] è¡¨ç¤º 0 -> 1, 1 -> 2
    - alpha: PageRank é˜»å°¼ç³»æ•°ï¼Œé»˜è®¤ 0.85
    
    è¿”å›ï¼š
    - {client_id: score} å­—å…¸ï¼Œscore ä¸ºåŸå§‹ PageRank åˆ†æ•°
    """
```

**è®¾è®¡ç›®çš„ï¼š**
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£å•ä¸€ï¼šåªè´Ÿè´£è®¡ç®— PageRankï¼Œä¸å…³å¿ƒæ•°æ®æ¥æº
- âœ… å¯å¤ç”¨ï¼šå¯ä»¥è¢«å…¶ä»–è„šæœ¬ä½¿ç”¨
- âœ… æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

---

### 2. `src/graph_extractor.py`ï¼ˆæ–°å¢ï¼‰

**ä½œç”¨ï¼š** ä»åŒºå—é“¾æ—¥å¿—ä¸­æå–å®¢æˆ·ç«¯é€šä¿¡å…³ç³»

**å…³é”®å‡½æ•°ï¼š**

```python
def extract_graph_from_rounds(log_path="logs/blockchain_log.jsonl", max_rounds=None):
    """
    ä»å¤šä¸ªè½®æ¬¡ä¸­æå–ç´¯ç§¯çš„é€šä¿¡å›¾
    
    å‚æ•°ï¼š
    - log_path: æ—¥å¿—æ–‡ä»¶è·¯å¾„
    - max_rounds: æœ€å¤§è½®æ¬¡æ•°ï¼ˆNone è¡¨ç¤ºæ‰€æœ‰è½®æ¬¡ï¼‰
    
    è¿”å›ï¼š
    - (clients, edges): å®¢æˆ·ç«¯åˆ—è¡¨å’Œæœ‰å‘è¾¹åˆ—è¡¨
    """
```

**å·¥ä½œæµç¨‹ï¼š**
1. è¯»å– `logs/blockchain_log.jsonl` æ–‡ä»¶
2. è§£ææ¯ä¸€è¡Œ JSON æ—¥å¿—
3. æ‰¾åˆ° `event_type == "CLIENT_UPDATE_SUBMITTED"` çš„äº‹ä»¶
4. æå– `client_id` å’Œ `round` ä¿¡æ¯
5. æ„å»ºé€šä¿¡å›¾ï¼ˆå¦‚æœæ—¥å¿—ä¸­æ²¡æœ‰è¶³å¤Ÿä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤ç¯çŠ¶æ‹“æ‰‘ï¼‰

**è®¾è®¡ç›®çš„ï¼š**
- âœ… åˆ†ç¦»å…³æ³¨ç‚¹ï¼šæ—¥å¿—è§£æ vs PageRank è®¡ç®—
- âœ… åˆ©ç”¨ç°æœ‰æ—¥å¿—ç³»ç»Ÿï¼šåŸå§‹è®­ç»ƒè„šæœ¬å·²ç»è®°å½•äº†é€šä¿¡æ—¥å¿—
- âœ… çµæ´»å¤„ç†ï¼šæ”¯æŒä»æŒ‡å®šè½®æ¬¡æå–ï¼Œä¹Ÿæ”¯æŒæå–æ‰€æœ‰è½®æ¬¡

---

### 3. `src/Serverlesscase/Serverless_NonIID_Medical_transcriptions_with_pagerank.py`ï¼ˆæ–°å¢ï¼ŒåŸºäºåŸå§‹è„šæœ¬ä¿®æ”¹ï¼‰

**ä½œç”¨ï¼š** åœ¨åŸå§‹è®­ç»ƒè„šæœ¬åŸºç¡€ä¸Šï¼Œé›†æˆ PageRank å‰”é™¤åŠŸèƒ½

**å…³é”®ä¿®æ”¹ä½ç½®ï¼š**

#### ä¿®æ”¹1ï¼šå¯¼å…¥æ–°æ¨¡å—ï¼ˆç¬¬28-29è¡Œï¼‰

```python
from src.pagerank_utils import compute_pagerank_scores, sort_scores_desc
from src.graph_extractor import extract_graph_from_rounds
```

#### ä¿®æ”¹2ï¼šæ·»åŠ é…ç½®å‚æ•°ï¼ˆç¬¬43è¡Œï¼‰

```python
PAGERANK_THRESHOLD = 0.3  # å‰”é™¤é˜ˆå€¼ï¼šPageRankåˆ†æ•° < 0.3 çš„å®¢æˆ·ç«¯å°†è¢«å‰”é™¤
```

#### ä¿®æ”¹3ï¼šæ·»åŠ æ´»è·ƒå®¢æˆ·ç«¯è¿½è¸ªï¼ˆç¬¬164è¡Œï¼‰

```python
active_clients = set(range(NUM_CLIENTS))  # è¿½è¸ªå“ªäº›å®¢æˆ·ç«¯è¿˜åœ¨è®­ç»ƒä¸­
```

**ä½œç”¨ï¼š** åŠ¨æ€è¿½è¸ªæ¯è½®è®­ç»ƒä¸­æ´»è·ƒçš„å®¢æˆ·ç«¯ï¼Œè¢«å‰”é™¤çš„å®¢æˆ·ç«¯ä¼šä»é›†åˆä¸­ç§»é™¤ã€‚

#### ä¿®æ”¹4ï¼šåœ¨èšåˆå‰æ’å…¥ PageRank è®¡ç®—å’Œå‰”é™¤ï¼ˆç¬¬230-359è¡Œï¼‰

```python
# ä»ç¬¬äºŒè½®å¼€å§‹åº”ç”¨ PageRank
if round_num > 0:
    # 1. ä»æ—¥å¿—æå–é€šä¿¡å›¾
    clients_from_log, edges_from_log = extract_graph_from_rounds(max_rounds=round_num + 1)
    
    # 2. è¿‡æ»¤ï¼šåªå¯¹å½“å‰æ´»è·ƒçš„å®¢æˆ·ç«¯è®¡ç®— PageRank
    active_clients_set = set(active_clients)
    clients = sorted([c for c in clients_from_log if c in active_clients_set])
    
    # 3. æ„å»ºåŸºäºæ´»è·ƒå®¢æˆ·ç«¯çš„å›¾ç»“æ„
    edges = [(src, dst) for src, dst in edges_from_log 
            if src in active_clients_set and dst in active_clients_set]
    
    # 4. è®¡ç®— PageRank åˆ†æ•°ï¼ˆåŸå§‹åˆ†æ•°ï¼‰
    pagerank_scores_raw = compute_pagerank_scores(clients, edges)
    
    # 5. å½’ä¸€åŒ–åˆ†æ•°åˆ° [0, 1] åŒºé—´
    pagerank_scores = normalize_scores(pagerank_scores_raw)
    
    # 6. ä¿å­˜åˆ†æ•°åˆ°æ–‡ä»¶
    save_scores_to_file(pagerank_scores_raw, pagerank_scores, round_num)
    
    # 7. å‰”é™¤ä½åˆ†å®¢æˆ·ç«¯
    for client_id in list(active_clients):
        if pagerank_scores[client_id] < PAGERANK_THRESHOLD:
            active_clients.remove(client_id)
            log_event(event_type="CLIENT_REMOVED", ...)
    
    # 8. åªèšåˆæ´»è·ƒå®¢æˆ·ç«¯çš„å‚æ•°
    aggregated_params = [
        client_params_dict[k] 
        for k in active_clients  # åªåŒ…å«æœªè¢«å‰”é™¤çš„å®¢æˆ·ç«¯
        if k in client_params_dict
    ]
```

**è®¾è®¡ç›®çš„ï¼š**
- âœ… **æœ€å°ä¾µå…¥**ï¼šä¸ç ´ååŸæœ‰ä»£ç ç»“æ„ï¼Œåªåœ¨å…³é”®ä½ç½®æ’å…¥é€»è¾‘
- âœ… **å‘åå…¼å®¹**ï¼šåŸå§‹è®­ç»ƒè„šæœ¬ä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œ
- âœ… **åŠ¨æ€è¿‡æ»¤**ï¼šåªå¯¹æ´»è·ƒå®¢æˆ·ç«¯è®¡ç®— PageRankï¼Œé¿å…åŒ…å«å·²è¢«å‰”é™¤çš„å®¢æˆ·ç«¯

---

## æ–°å¢çš„Pythonæ–‡ä»¶è¯´æ˜

æœ¬èŠ‚è¯¦ç»†ä»‹ç» PageRank é›†æˆè¿‡ç¨‹ä¸­æ–°å¢çš„ 4 ä¸ª Python æ–‡ä»¶åŠå…¶ä½œç”¨ã€‚

### 1. `src/pagerank_utils.py` - PageRank è®¡ç®—å·¥å…·

**æ–‡ä»¶ä½œç”¨ï¼š**  
æä¾› PageRank ç®—æ³•çš„æ ¸å¿ƒè®¡ç®—åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·æ¨¡å—ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**

1. **`build_client_graph(clients, edges)`**
   - æ ¹æ®å®¢æˆ·ç«¯ ID åˆ—è¡¨å’Œæœ‰å‘è¾¹æ„å»º networkx æœ‰å‘å›¾
   - è¾“å…¥ï¼šå®¢æˆ·ç«¯åˆ—è¡¨ï¼ˆå¦‚ `[0, 1, 2, 3]`ï¼‰å’Œè¾¹åˆ—è¡¨ï¼ˆå¦‚ `[(0, 1), (1, 2)]`ï¼‰
   - è¾“å‡ºï¼šnetworkx.DiGraph å¯¹è±¡

2. **`compute_pagerank_scores(clients, edges, alpha=0.85)`**
   - è®¡ç®—æ¯ä¸ªå®¢æˆ·ç«¯çš„ PageRank å¾—åˆ†
   - ä½¿ç”¨ networkx åº“çš„ `pagerank` å‡½æ•°å®ç°
   - è¿”å›ï¼š`{client_id: score}` å­—å…¸ï¼Œåˆ†æ•°ä¸ºåŸå§‹ PageRank å€¼ï¼ˆæ‰€æœ‰åˆ†æ•°ä¹‹å’Œçº¦ä¸º 1ï¼‰

3. **`sort_scores_desc(scores)`**
   - å°†åˆ†æ•°å­—å…¸æŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åº
   - è¿”å›ï¼š`[(client_id, score), ...]` åˆ—è¡¨ï¼Œä¾¿äºæ‰“å°å’Œç­›é€‰

**ä½¿ç”¨åœºæ™¯ï¼š**
- è¢«è®­ç»ƒè„šæœ¬ `Serverless_NonIID_Medical_transcriptions_with_pagerank.py` è°ƒç”¨
- å¯ä»¥è¢«å…¶ä»–éœ€è¦ PageRank åŠŸèƒ½çš„è„šæœ¬å¤ç”¨
- ç‹¬ç«‹æµ‹è¯•ï¼šè¿è¡Œ `python src/pagerank_utils.py` å¯ä»¥çœ‹åˆ°ç¤ºä¾‹è¾“å‡º

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- âœ… **èŒè´£å•ä¸€**ï¼šåªè´Ÿè´£è®¡ç®— PageRankï¼Œä¸å…³å¿ƒæ•°æ®æ¥æº
- âœ… **å¯å¤ç”¨**ï¼šå¯ä»¥è¢«ä»»ä½•éœ€è¦ PageRank åŠŸèƒ½çš„è„šæœ¬ä½¿ç”¨
- âœ… **æ˜“äºæµ‹è¯•**ï¼šåŒ…å«è‡ªæµ‹ä»£ç ï¼Œå¯ä»¥ç›´æ¥è¿è¡ŒéªŒè¯åŠŸèƒ½

---

### 2. `src/graph_extractor.py` - é€šä¿¡å›¾æå–å·¥å…·

**æ–‡ä»¶ä½œç”¨ï¼š**  
ä»åŒºå—é“¾è®­ç»ƒæ—¥å¿—ä¸­æå–å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡å…³ç³»ï¼Œæ„å»ºç”¨äº PageRank è®¡ç®—çš„å›¾ç»“æ„ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**

1. **`extract_communication_graph(log_path, round_id=None)`**
   - ä»æ—¥å¿—æ–‡ä»¶ä¸­æå–æŒ‡å®šè½®æ¬¡çš„é€šä¿¡å›¾
   - å‚æ•°ï¼š
     - `log_path`: æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ `logs/blockchain_log.jsonl`ï¼‰
     - `round_id`: æŒ‡å®šè½®æ¬¡ï¼ˆ`None` è¡¨ç¤ºæ‰€æœ‰è½®æ¬¡ï¼‰
   - è¿”å›ï¼š`(clients, edges)` å…ƒç»„

2. **`extract_graph_from_rounds(log_path, max_rounds=None)`**
   - ä»å¤šä¸ªè½®æ¬¡ä¸­æå–ç´¯ç§¯çš„é€šä¿¡å›¾ï¼ˆæ›´å¸¸ç”¨ï¼‰
   - å‚æ•°ï¼š
     - `log_path`: æ—¥å¿—æ–‡ä»¶è·¯å¾„
     - `max_rounds`: æœ€å¤§è½®æ¬¡æ•°ï¼ˆ`None` è¡¨ç¤ºæ‰€æœ‰è½®æ¬¡ï¼‰
   - è¿”å›ï¼š`(clients, edges)` å…ƒç»„
   - **ç‰¹ç‚¹**ï¼šç´¯ç§¯å¤šä¸ªè½®æ¬¡çš„æ•°æ®ï¼Œæ„å»ºæ›´å®Œæ•´çš„é€šä¿¡å›¾

**å·¥ä½œæµç¨‹ï¼š**
1. è¯»å– `logs/blockchain_log.jsonl` æ–‡ä»¶
2. è§£ææ¯ä¸€è¡Œ JSON æ—¥å¿—
3. æŸ¥æ‰¾ `event_type == "CLIENT_UPDATE_SUBMITTED"` çš„äº‹ä»¶
4. æå– `client_id` å’Œ `round` ä¿¡æ¯
5. å¦‚æœæ—¥å¿—ä¸­æ²¡æœ‰è¶³å¤Ÿçš„è¾¹ä¿¡æ¯ï¼Œæ„å»ºé»˜è®¤çš„ç¯çŠ¶æ‹“æ‰‘ï¼š
   - ç¯çŠ¶ç»“æ„ï¼š`0 -> 1 -> 2 -> ... -> n-1 -> 0`
   - é¢å¤–è¾¹ï¼š`(n-1, 0)` å’Œ `(n-2, 0)`ï¼ˆå¦‚æœå®¢æˆ·ç«¯æ•° >= 4ï¼‰

**ä½¿ç”¨åœºæ™¯ï¼š**
- è¢«è®­ç»ƒè„šæœ¬è°ƒç”¨ï¼Œåœ¨æ¯è½®è®­ç»ƒåæå–é€šä¿¡å›¾
- æ”¯æŒä»æŒ‡å®šè½®æ¬¡æå–ï¼Œä¹Ÿæ”¯æŒæå–æ‰€æœ‰è½®æ¬¡
- å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºå›¾ï¼ˆä¸ä¼šæŠ¥é”™ï¼‰

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- âœ… **å®¹é”™æ€§å¼º**ï¼šæ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨æ—¶è¿”å›ç©ºå›¾ï¼Œä¸ä¼šä¸­æ–­è®­ç»ƒ
- âœ… **çµæ´»æå–**ï¼šæ”¯æŒå•è½®æ¬¡æå–å’Œç´¯ç§¯æå–
- âœ… **é»˜è®¤æ‹“æ‰‘**ï¼šå½“æ—¥å¿—ä¿¡æ¯ä¸è¶³æ—¶ï¼Œä½¿ç”¨åˆç†çš„é»˜è®¤æ‹“æ‰‘ç»“æ„

---

### 3. `src/run_comparison.py` - å¯¹æ¯”å®éªŒè„šæœ¬

**æ–‡ä»¶ä½œç”¨ï¼š**  
è¿è¡Œå¯¹æ¯”å®éªŒï¼Œæ¯”è¾ƒæœ‰/æ—  PageRank çš„è®­ç»ƒæ•ˆæœï¼Œå¹¶ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Šã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**

1. **`extract_accuracies_from_output(output)`**
   - ä»æ§åˆ¶å°è¾“å‡ºä¸­æå–å‡†ç¡®ç‡
   - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… `"Global Model Accuracy: XX.XX%"` æ ¼å¼

2. **`extract_accuracies_from_logs(log_file)`**
   - ä»æ—¥å¿—æ–‡ä»¶ä¸­æå–å‡†ç¡®ç‡
   - æŸ¥æ‰¾ `event_type == "GLOBAL_EVAL"` çš„äº‹ä»¶
   - æå– `details.global_accuracy` å­—æ®µ

3. **`run_training(script_name, description)`**
   - è¿è¡ŒæŒ‡å®šçš„è®­ç»ƒè„šæœ¬ï¼ˆbaseline æˆ– with PageRankï¼‰
   - ä½¿ç”¨ subprocess è°ƒç”¨ Python è„šæœ¬
   - æ•è·è¾“å‡ºå¹¶æå–å‡†ç¡®ç‡
   - è¿”å›ï¼š`(success, output, accuracies)` å…ƒç»„

4. **`generate_comparison_report(baseline_accuracies, pagerank_accuracies, output_file)`**
   - ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
   - å¯¹æ¯”æ¯è½®çš„å‡†ç¡®ç‡å˜åŒ–
   - è®¡ç®—æœ€ç»ˆå‡†ç¡®ç‡çš„æå‡/é™ä½
   - ä¿å­˜åˆ° `pagerank_comparison_report.txt`

**å·¥ä½œæµç¨‹ï¼š**
```
1. è¿è¡Œ baseline è®­ç»ƒï¼ˆæ—  PageRankï¼‰
   â””â”€> è°ƒç”¨ Serverless_NonIID_Medical_transcriptions.py
   â””â”€> æå–å‡†ç¡®ç‡åˆ—è¡¨

2. è¿è¡Œ PageRank è®­ç»ƒ
   â””â”€> è°ƒç”¨ Serverless_NonIID_Medical_transcriptions_with_pagerank.py
   â””â”€> æå–å‡†ç¡®ç‡åˆ—è¡¨

3. ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
   â””â”€> å¯¹æ¯”æ¯è½®å‡†ç¡®ç‡
   â””â”€> è®¡ç®—æå‡/é™ä½ç™¾åˆ†æ¯”
   â””â”€> ä¿å­˜åˆ°æ–‡ä»¶
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- **å®éªŒå¯¹æ¯”**ï¼šéœ€è¦éªŒè¯ PageRank æ˜¯å¦æå‡æ¨¡å‹å‡†ç¡®ç‡æ—¶ä½¿ç”¨
- **æ€§èƒ½è¯„ä¼°**ï¼šè¯„ä¼° PageRank å¯¹è®­ç»ƒæ•ˆæœçš„å½±å“
- **æŠ¥å‘Šç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Šï¼Œä¾¿äºåˆ†æå’Œå±•ç¤º

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python src/run_comparison.py
```

**è¾“å‡ºæ–‡ä»¶ï¼š**
- `pagerank_comparison_report.txt`ï¼šåŒ…å«è¯¦ç»†çš„å¯¹æ¯”åˆ†ææŠ¥å‘Š

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- âœ… **è‡ªåŠ¨åŒ–**ï¼šä¸€é”®è¿è¡Œä¸¤ä¸ªè®­ç»ƒè„šæœ¬å¹¶ç”ŸæˆæŠ¥å‘Š
- âœ… **å®¹é”™å¤„ç†**ï¼šè®­ç»ƒå¤±è´¥æ—¶ä¸ä¼šä¸­æ–­ï¼Œä¼šè®°å½•é”™è¯¯ä¿¡æ¯
- âœ… **å¤šæºæå–**ï¼šä»æ§åˆ¶å°è¾“å‡ºå’Œæ—¥å¿—æ–‡ä»¶ä¸¤ä¸ªæ¥æºæå–å‡†ç¡®ç‡

---

### 4. `src/verify_pagerank_integration.py` - é›†æˆéªŒè¯è„šæœ¬

**æ–‡ä»¶ä½œç”¨ï¼š**  
å¿«é€ŸéªŒè¯ PageRank é›†æˆæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ£€æŸ¥æ‰€æœ‰å¿…éœ€æ–‡ä»¶å’ŒåŠŸèƒ½æ˜¯å¦å°±ç»ªã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**

1. **`check_file_exists(file_path, description)`**
   - æ£€æŸ¥æŒ‡å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - è¿”å›ï¼š`(exists, message)` å…ƒç»„

2. **`check_pagerank_import()`**
   - æ£€æŸ¥ PageRank æ¨¡å—æ˜¯å¦å¯ä»¥æ­£å¸¸å¯¼å…¥
   - éªŒè¯ `pagerank_utils` å’Œ `graph_extractor` æ¨¡å—

3. **`check_pagerank_functionality()`**
   - æµ‹è¯• PageRank å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - ä½¿ç”¨ç®€å•çš„æµ‹è¯•æ•°æ®ï¼ˆ4ä¸ªå®¢æˆ·ç«¯ï¼Œç¯çŠ¶æ‹“æ‰‘ï¼‰
   - éªŒè¯è¿”å›çš„åˆ†æ•°æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…

4. **`check_log_format(log_file)`**
   - æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
   - éªŒè¯ JSON æ ¼å¼æ˜¯å¦æœ‰æ•ˆ
   - ç»Ÿè®¡æœ‰æ•ˆæ—¥å¿—è¡Œæ•°

**æ£€æŸ¥é¡¹ç›®ï¼š**
1. âœ… **å¿…éœ€æ–‡ä»¶æ£€æŸ¥**
   - `src/pagerank_utils.py`
   - `src/graph_extractor.py`
   - `src/Serverlesscase/Serverless_NonIID_Medical_transcriptions.py`
   - `src/Serverlesscase/Serverless_NonIID_Medical_transcriptions_with_pagerank.py`
   - `src/run_comparison.py`

2. âœ… **æ¨¡å—å¯¼å…¥æ£€æŸ¥**
   - éªŒè¯ PageRank ç›¸å…³æ¨¡å—å¯ä»¥æ­£å¸¸å¯¼å…¥

3. âœ… **åŠŸèƒ½æµ‹è¯•**
   - éªŒè¯ PageRank è®¡ç®—å‡½æ•°æ­£å¸¸å·¥ä½œ
   - éªŒè¯è¿”å›çš„åˆ†æ•°æ ¼å¼æ­£ç¡®

4. âœ… **æ—¥å¿—æ–‡ä»¶æ£€æŸ¥**
   - éªŒè¯æ—¥å¿—æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

**ä½¿ç”¨åœºæ™¯ï¼š**
- **é¦–æ¬¡ä½¿ç”¨**ï¼šåœ¨è¿è¡Œè®­ç»ƒè„šæœ¬å‰ï¼ŒéªŒè¯ç¯å¢ƒæ˜¯å¦æ­£ç¡®é…ç½®
- **é—®é¢˜æ’æŸ¥**ï¼šå½“é‡åˆ°é—®é¢˜æ—¶ï¼Œå¿«é€Ÿæ£€æŸ¥å“ªäº›éƒ¨åˆ†å¯èƒ½æœ‰é—®é¢˜
- **ç¯å¢ƒéªŒè¯**ï¼šåœ¨æ–°ç¯å¢ƒä¸­éƒ¨ç½²æ—¶ï¼ŒéªŒè¯æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å®Œæ•´

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python src/verify_pagerank_integration.py
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
================================================================================
PageRank é›†æˆéªŒè¯
================================================================================

ã€1/4ã€‘æ£€æŸ¥å¿…éœ€æ–‡ä»¶...
  âœ“ PageRank å·¥å…·æ¨¡å—: D:\...\src\pagerank_utils.py
  âœ“ å›¾æå–æ¨¡å—: D:\...\src\graph_extractor.py
  ...

ã€2/4ã€‘æ£€æŸ¥æ¨¡å—å¯¼å…¥...
  âœ“ PageRank æ¨¡å—å¯¼å…¥æˆåŠŸ

ã€3/4ã€‘æ£€æŸ¥ PageRank åŠŸèƒ½...
  âœ“ PageRank å‡½æ•°æµ‹è¯•é€šè¿‡ (åˆ†æ•°: {0: 0.25, 1: 0.25, ...})

ã€4/4ã€‘æ£€æŸ¥æ—¥å¿—æ–‡ä»¶...
  âœ“ æ—¥å¿—æ–‡ä»¶æ ¼å¼æ­£ç¡® (5/5 è¡Œæœ‰æ•ˆ)

================================================================================
éªŒè¯ç»“æœæ€»ç»“
================================================================================
âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼PageRank é›†æˆæ­£å¸¸ã€‚
```

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- âœ… **å…¨é¢æ£€æŸ¥**ï¼šè¦†ç›–æ–‡ä»¶ã€å¯¼å…¥ã€åŠŸèƒ½ã€æ—¥å¿—ç­‰å¤šä¸ªæ–¹é¢
- âœ… **å‹å¥½è¾“å‡º**ï¼šä½¿ç”¨ âœ“/âœ— ç¬¦å·ï¼Œæ¸…æ™°æ˜¾ç¤ºæ£€æŸ¥ç»“æœ
- âœ… **å¿«é€Ÿè¯Šæ–­**ï¼šå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨

---

### æ–‡ä»¶å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  verify_pagerank_integration.py                           â”‚
â”‚  ï¼ˆéªŒè¯è„šæœ¬ï¼‰                                               â”‚
â”‚  - æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å­˜åœ¨                                      â”‚
â”‚  - éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ éªŒè¯
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pagerank_utils.py                                          â”‚
â”‚  ï¼ˆæ ¸å¿ƒå·¥å…·ï¼‰                                                â”‚
â”‚  - è®¡ç®— PageRank åˆ†æ•°                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ è¢«è°ƒç”¨
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  graph_extractor.py                                        â”‚
â”‚  ï¼ˆæ•°æ®æå–ï¼‰                                                â”‚
â”‚  - ä»æ—¥å¿—æå–é€šä¿¡å›¾                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ è¢«è°ƒç”¨
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Serverless_NonIID_Medical_transcriptions_with_pagerank.py â”‚
â”‚  ï¼ˆè®­ç»ƒè„šæœ¬ï¼‰                                                â”‚
â”‚  - é›†æˆ PageRank çš„è®­ç»ƒæµç¨‹                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ å¯¹æ¯”
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  run_comparison.py                                         â”‚
â”‚  ï¼ˆå¯¹æ¯”å®éªŒï¼‰                                                â”‚
â”‚  - è¿è¡Œ baseline å’Œ PageRank è®­ç»ƒ                             â”‚
â”‚  - ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å·¥ä½œæµç¨‹

### å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®­ç»ƒè„šæœ¬ï¼ˆServerless_NonIID_Medical_transcriptions_      â”‚
â”‚            with_pagerank.pyï¼‰                               â”‚
â”‚  - 8ä¸ªå®¢æˆ·ç«¯è®­ç»ƒ                                              â”‚
â”‚  - è®°å½•æ—¥å¿—ï¼šCLIENT_UPDATE_SUBMITTED                         â”‚
â”‚  - å†™å…¥ï¼šlogs/blockchain_log.jsonl                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  graph_extractor.py                                         â”‚
â”‚  - è¯»å– blockchain_log.jsonl                                 â”‚
â”‚  - æå–å®¢æˆ·ç«¯é€šä¿¡å…³ç³»                                         â”‚
â”‚  - è¾“å‡ºï¼š(clients, edges)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pagerank_utils.py                                          â”‚
â”‚  - æ¥æ”¶ (clients, edges)                                     â”‚
â”‚  - è®¡ç®— PageRank åˆ†æ•°ï¼ˆåŸå§‹åˆ†æ•°ï¼‰                             â”‚
â”‚  - è¾“å‡ºï¼š{0: 0.208, 1: 0.244, ...}                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®­ç»ƒè„šæœ¬ï¼ˆå½’ä¸€åŒ–å’Œå‰”é™¤ï¼‰                                      â”‚
â”‚  - å½’ä¸€åŒ–åˆ†æ•°åˆ° [0, 1] åŒºé—´                                   â”‚
â”‚  - æ ‡è®°ä½åˆ†å®¢æˆ·ç«¯ï¼ˆ< 0.3ï¼‰                                    â”‚
â”‚  - ä» active_clients ä¸­ç§»é™¤                                   â”‚
â”‚  - åªèšåˆé«˜åˆ†å®¢æˆ·ç«¯çš„å‚æ•°                                     â”‚
â”‚  - è¾“å‡ºï¼špagerank_scores.txt + å‰”é™¤æ—¥å¿—                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®­ç»ƒè½®æ¬¡ç¤ºä¾‹

**Round 1ï¼š**
```
1. 8ä¸ªå®¢æˆ·ç«¯è®­ç»ƒ
2. æ‰€æœ‰å®¢æˆ·ç«¯æäº¤æ›´æ–° â†’ è®°å½•æ—¥å¿—
3. èšåˆæ‰€æœ‰8ä¸ªå®¢æˆ·ç«¯çš„å‚æ•°
4. âŒ ä¸åº”ç”¨ PageRankï¼ˆéœ€è¦å…ˆæœ‰æ—¥å¿—æ‰èƒ½è®¡ç®—ï¼‰
```

**Round 2ï¼š**
```
1. 8ä¸ªå®¢æˆ·ç«¯è®­ç»ƒï¼ˆä½¿ç”¨ Round 1 çš„å…¨å±€æ¨¡å‹ï¼‰
2. æ‰€æœ‰å®¢æˆ·ç«¯æäº¤æ›´æ–° â†’ è®°å½•æ—¥å¿—
3. âœ… åº”ç”¨ PageRankï¼š
   - ä»æ—¥å¿—æå–é€šä¿¡å›¾ï¼ˆRound 1 + Round 2ï¼‰
   - è®¡ç®— PageRank åˆ†æ•°
   - å½’ä¸€åŒ–åˆ†æ•°
   - ä¿å­˜åˆ° pagerank_scores.txt
   - å‰”é™¤ä½åˆ†å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼šå®¢æˆ·ç«¯4,5,6,7è¢«å‰”é™¤ï¼‰
4. åªèšåˆé«˜åˆ†å®¢æˆ·ç«¯çš„å‚æ•°ï¼ˆä¾‹å¦‚ï¼šåªèšåˆå®¢æˆ·ç«¯0,1,2,3ï¼‰
5. è®°å½•å‰”é™¤æ—¥å¿—åˆ° blockchain_log.jsonl
```

**Round 3ï¼š**
```
1. åªæœ‰4ä¸ªå®¢æˆ·ç«¯è®­ç»ƒï¼ˆå®¢æˆ·ç«¯4,5,6,7å·²è¢«å‰”é™¤ï¼‰
2. è¿™4ä¸ªå®¢æˆ·ç«¯æäº¤æ›´æ–° â†’ è®°å½•æ—¥å¿—
3. âœ… å†æ¬¡åº”ç”¨ PageRankï¼š
   - ä»æ—¥å¿—æå–é€šä¿¡å›¾ï¼ˆæ‰€æœ‰è½®æ¬¡ï¼Œä½†åªåŒ…å«æ´»è·ƒå®¢æˆ·ç«¯ï¼‰
   - é‡æ–°è®¡ç®— PageRank åˆ†æ•°ï¼ˆåªå¯¹4ä¸ªæ´»è·ƒå®¢æˆ·ç«¯ï¼‰
   - å¯èƒ½è¿›ä¸€æ­¥å‰”é™¤æ›´å¤šå®¢æˆ·ç«¯
4. åªèšåˆå‰©ä½™é«˜åˆ†å®¢æˆ·ç«¯çš„å‚æ•°
```

---

## è¾“å‡ºæ–‡ä»¶

### 1. `pagerank_scores.txt`

æ¯è½®è®­ç»ƒåç”Ÿæˆçš„ PageRank åˆ†æ•°æ–‡ä»¶ï¼ŒåŒ…å«åŸå§‹åˆ†æ•°å’Œå½’ä¸€åŒ–åˆ†æ•°ã€‚

**æ ¼å¼ï¼š**
```
# Round 2 - PageRank scores (normalized)
# client_id	pagerank_score_raw	pagerank_score_normalized
1	0.244482	1.000000
2	0.226562	0.915234
0	0.207997	0.840123
3	0.115038	0.464567
4	0.067641	0.273456  â† ä½äº0.3ï¼Œä¼šè¢«å‰”é™¤
7	0.051846	0.209234  â† ä½äº0.3ï¼Œä¼šè¢«å‰”é™¤
5	0.047498	0.191789  â† ä½äº0.3ï¼Œä¼šè¢«å‰”é™¤
6	0.038937	0.157234  â† ä½äº0.3ï¼Œä¼šè¢«å‰”é™¤
```

### 2. `logs/blockchain_log.jsonl`ï¼ˆæ–°å¢å‰”é™¤æ—¥å¿—ï¼‰

æ¯è½®å‰”é™¤å®¢æˆ·ç«¯æ—¶ï¼Œä¼šè®°å½• `CLIENT_REMOVED` äº‹ä»¶ã€‚

**æ ¼å¼ï¼š**
```json
{
  "event_type": "CLIENT_REMOVED",
  "round": 1,
  "client_id": 4,
  "message": "client 4 removed",
  "details": {
    "pagerank_score_raw": 0.067641,
    "pagerank_score_normalized": 0.273456,
    "threshold": 0.3,
    "reason": "low normalized PageRank score"
  }
}
```

### 3. æ§åˆ¶å°è¾“å‡º

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè¾“å‡º PageRank è®¡ç®—å’Œå‰”é™¤ä¿¡æ¯ï¼š

```
=== Computing PageRank scores ===
PageRank normalization: [0.038937, 0.244482] -> [0.0, 1.0]
PageRank scores saved to: D:\...\pagerank_scores.txt
PageRank scores (normalized):
  client 1: 1.0000 (raw: 0.2445)
  client 2: 0.9152 (raw: 0.2266)
  client 0: 0.8401 (raw: 0.2080)
  client 3: 0.4646 (raw: 0.1150)
  client 4: 0.2735 (raw: 0.0676)
âš ï¸  client 4 removed (normalized PageRank: 0.2735 < 0.3, raw: 0.0676)
âš ï¸  client 5 removed (normalized PageRank: 0.1918 < 0.3, raw: 0.0475)
âš ï¸  client 6 removed (normalized PageRank: 0.1572 < 0.3, raw: 0.0389)
âš ï¸  client 7 removed (normalized PageRank: 0.2092 < 0.3, raw: 0.0518)
Removed clients: [4, 5, 6, 7]
Remaining active clients: [0, 1, 2, 3]
```

---

## æ€»ç»“

### PageRank çš„ä½œç”¨

1. **è¯„ä¼°å®¢æˆ·ç«¯é‡è¦æ€§**ï¼šæ ¹æ®é€šä¿¡å…³ç³»è®¡ç®—åˆ†æ•°
2. **è¯†åˆ«å¼‚å¸¸å®¢æˆ·ç«¯**ï¼šä½åˆ†å®¢æˆ·ç«¯å¯èƒ½æ˜¯å¼‚å¸¸çš„
3. **æå‡è®­ç»ƒè´¨é‡**ï¼šåªä½¿ç”¨é«˜è´¨é‡å®¢æˆ·ç«¯çš„å‚æ•°

### å…³é”®è®¾è®¡åŸåˆ™

- âœ… **æœ€å°ä¾µå…¥**ï¼šä¸ç ´ååŸæœ‰ä»£ç ç»“æ„
- âœ… **æ¨¡å—åŒ–**ï¼šæ¯ä¸ªæ–‡ä»¶èŒè´£å•ä¸€ï¼Œä¾¿äºç»´æŠ¤
- âœ… **å¯å¤ç”¨**ï¼šPageRank å·¥å…·å¯ä»¥è¢«å…¶ä»–è„šæœ¬ä½¿ç”¨
- âœ… **å‘åå…¼å®¹**ï¼šåŸå§‹è®­ç»ƒè„šæœ¬ä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œ
- âœ… **åŠ¨æ€è¿‡æ»¤**ï¼šåªå¯¹æ´»è·ƒå®¢æˆ·ç«¯è®¡ç®—ï¼Œé¿å…åŒ…å«å·²å‰”é™¤çš„å®¢æˆ·ç«¯

### ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡è¿è¡Œ**ï¼šä½¿ç”¨é»˜è®¤é˜ˆå€¼ 0.3ï¼Œè§‚å¯Ÿå‰”é™¤æ•ˆæœ
2. **è°ƒæ•´é˜ˆå€¼**ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ `PAGERANK_THRESHOLD`
   - æ›´ä¸¥æ ¼ï¼šæé«˜é˜ˆå€¼ï¼ˆå¦‚ 0.4ï¼‰ï¼Œä¿ç•™æ›´å°‘å®¢æˆ·ç«¯
   - æ›´å®½æ¾ï¼šé™ä½é˜ˆå€¼ï¼ˆå¦‚ 0.2ï¼‰ï¼Œä¿ç•™æ›´å¤šå®¢æˆ·ç«¯
3. **ç›‘æ§è¾“å‡º**ï¼šæŸ¥çœ‹ `pagerank_scores.txt` å’Œæ—¥å¿—æ–‡ä»¶ï¼Œäº†è§£å®¢æˆ·ç«¯åˆ†æ•°åˆ†å¸ƒ
4. **å¯¹æ¯”å®éªŒ**ï¼šå¯ä»¥å¯¹æ¯”æœ‰/æ—  PageRank çš„è®­ç»ƒæ•ˆæœ

---

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆç¬¬ä¸€è½®ä¸åº”ç”¨ PageRankï¼Ÿ**  
A: PageRank éœ€è¦ä»æ—¥å¿—ä¸­æå–é€šä¿¡å…³ç³»ï¼Œç¬¬ä¸€è½®è®­ç»ƒæ—¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„æ—¥å¿—æ•°æ®ã€‚

**Q: è¢«å‰”é™¤çš„å®¢æˆ·ç«¯ä¼šé‡æ–°åŠ å…¥å—ï¼Ÿ**  
A: ä¸ä¼šã€‚ä¸€æ—¦è¢«å‰”é™¤ï¼Œè¯¥å®¢æˆ·ç«¯å°±ä¸ä¼šå†å‚ä¸åç»­è®­ç»ƒã€‚

**Q: å¦‚ä½•è°ƒæ•´å‰”é™¤é˜ˆå€¼ï¼Ÿ**  
A: ä¿®æ”¹è®­ç»ƒè„šæœ¬ä¸­çš„ `PAGERANK_THRESHOLD` å‚æ•°ï¼ˆé»˜è®¤ 0.3ï¼‰ã€‚

**Q: PageRank åˆ†æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ**  
A: ä½¿ç”¨ networkx åº“çš„ `pagerank` å‡½æ•°ï¼ŒåŸºäºå®¢æˆ·ç«¯é€šä¿¡å›¾è®¡ç®—ã€‚

**Q: ä¸ºä»€ä¹ˆéœ€è¦å½’ä¸€åŒ–ï¼Ÿ**  
A: å½’ä¸€åŒ–ä½¿å¾—é˜ˆå€¼åˆ¤æ–­åœ¨ä¸åŒå®¢æˆ·ç«¯æ•°é‡ä¸‹ä¿æŒä¸€è‡´ï¼Œ0.3 å§‹ç»ˆè¡¨ç¤º"ç›¸å¯¹æ’ååœ¨å‰70%"ã€‚

